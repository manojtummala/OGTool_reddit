// prisma/schema.prisma
datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

generator client {
  provider = "prisma-client-js"
}

model Company {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?

  personas    Persona[]
  targets     Target[]
  keywords    Keyword[]
  weeks       WeekPlan[]
}

model Persona {
  id          String   @id @default(cuid())
  username    String   // stored as "u/username"
  description String?

  companyId   String
  company     Company  @relation(fields: [companyId], references: [id])

  posts       Post[]
  comments    Comment[]
}

model Target {
  id        String   @id @default(cuid())
  subreddit String   // stored as "r/subreddit"

  companyId String
  company   Company  @relation(fields: [companyId], references: [id])

  posts     Post[]
}

model Keyword {
  id        String   @id @default(cuid())
  keyword   String   // e.g., "best ai presentation maker"
  companyId String
  company   Company  @relation(fields: [companyId], references: [id])

  postKeywords PostKeyword[]
}

model WeekPlan {
  id        String  @id @default(cuid())
  startDate DateTime @default(now())

  companyId String
  company   Company @relation(fields: [companyId], references: [id])

  posts     Post[]
}

model Post {
  id         String   @id @default(cuid())
  day        Int      // 1â€“7
  title      String?
  body       String?
  subreddit  String
  personaName String?
  
  weekId     String
  week       WeekPlan @relation(fields: [weekId], references: [id])

  personaId  String?
  persona    Persona? @relation(fields: [personaId], references: [id])

  targetId   String?
  target     Target?  @relation(fields: [targetId], references: [id])

  postKeywords PostKeyword[]
  comments     Comment[]
}

model PostKeyword {
  id        String  @id @default(cuid())
  postId    String
  post      Post    @relation(fields: [postId], references: [id], onDelete: Cascade)
  keywordId String
  keyword   Keyword @relation(fields: [keywordId], references: [id])

  @@unique([postId, keywordId])
}

model Comment {
  id              String   @id @default(cuid())
  text            String
  authorUsername  String   // persona username
  timestamp       DateTime
  
  postId          String
  post            Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  
  parentCommentId String?
  parentComment    Comment? @relation("CommentReplies", fields: [parentCommentId], references: [id])
  replies          Comment[] @relation("CommentReplies")
  
  personaId       String?
  persona         Persona? @relation(fields: [personaId], references: [id])
}